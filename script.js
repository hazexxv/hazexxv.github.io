(()=>{const w=window;const d=document;function q(s){return d.querySelectorAll(s)}function el(id){return d.getElementById(id)}function s(n){return(n||"").toString()}function H(id){q("main section").forEach(x=>x.style.display="none");const e=el(id);if(e)e.style.display="block"}q(".tab").forEach(t=>t.addEventListener("click",()=>{const i=t.dataset.tab;location.hash="#"+i;H(i)}));w.addEventListener("hashchange",()=>H((location.hash||"#home").substring(1)));H((location.hash||"#home").substring(1)||"home");const P=["winning","you","gaming","watching","creating","exploring"];let pi=0;const tg=el("tagline");setInterval(()=>{if(!tg)return;tg.style.opacity=0;setTimeout(()=>{tg.textContent="is for "+P[pi%P.length];tg.style.opacity=1;pi++},420)},2400);const THEMES=[{id:"default",v:{bg:"#011a05",fg:"#fff",a:"#003300",ad:"#002200",al:"#99ff99",r1:"#99ff99",r2:"#66cc66"}},{id:"light",v:{bg:"#f5f5f5",fg:"#222",a:"#88cc88",ad:"#669966",al:"#ccffcc",r1:"#88cc88",r2:"#66aa66"}},{id:"black",v:{bg:"#000",fg:"#fff",a:"#222",ad:"#000",al:"#444",r1:"#444",r2:"#666"}},{id:"midnight",v:{bg:"#001a33",fg:"#e0e6f1",a:"#335577",ad:"#223344",al:"#4477aa",r1:"#335577",r2:"#4477aa"}},{id:"ember",v:{bg:"#2b0f0c",fg:"#f2e3d5",a:"#b33a1e",ad:"#8b2f17",al:"#e0573c",r1:"#b33a1e",r2:"#e0573c"}},{id:"lunar",v:{bg:"#2e2e3a",fg:"#dcdce4",a:"#7f7fa3",ad:"#5e5e6c",al:"#a0a0b3",r1:"#7f7fa3",r2:"#a0a0b3"}},{id:"sunset",v:{bg:"#3b1e16",fg:"#ffe5d0",a:"#d9764e",ad:"#b3593b",al:"#f09e7a",r1:"#d9764e",r2:"#f09e7a"}},{id:"crimson",v:{bg:"#220706",fg:"#f5d7d0",a:"#8a0707",ad:"#660505",al:"#bb1616",r1:"#8a0707",r2:"#bb1616"}},{id:"royalty",v:{bg:"#1e0f2c",fg:"#f0e6f8",a:"#5e2a7e",ad:"#4a1f65",al:"#7a39a8",r1:"#5e2a7e",r2:"#7a39a8"}},{id:"ocean",v:{bg:"#002b3a",fg:"#d0eaf1",a:"#0e7490",ad:"#0b586e",al:"#339fbf",r1:"#0e7490",r2:"#339fbf"}}];function A(id){const t=THEMES.find(x=>x.id===id)||THEMES[2];const r=d.documentElement;r.style.setProperty("--bg",t.v.bg);r.style.setProperty("--fg",t.v.fg);r.style.setProperty("--accent",t.v.a);r.style.setProperty("--accent-dark",t.v.ad);r.style.setProperty("--accent-light",t.v.al);r.style.setProperty("--subtle-rain-1",t.v.r1);r.style.setProperty("--subtle-rain-2",t.v.r2);localStorage.setItem("astraTheme",id);q(".tab img").forEach(img=>{img.style.filter=t.v.fg==="#fff"?"invert(1) grayscale(1) contrast(0.9)":"invert(0) grayscale(0)"});if(Psys)Psys.setColor(t.v.al)}A(localStorage.getItem("astraTheme")||"black");class PS{constructor(c){this.c=c;this.x=c.getContext("2d",{alpha:true});this.dpr=Math.max(1,window.devicePixelRatio||1);this.p=[];this.m={x:-9999,y:-9999};this.max=90;this.color=getComputedStyle(document.documentElement).getPropertyValue("--accent-light").trim()||"#444";this.line=this.color;this.resize();this.init();this.f=this.f.bind(this);window.addEventListener("resize",()=>{this.resize();this.init()});window.addEventListener("mousemove",e=>{this.m.x=e.clientX;this.m.y=e.clientY});window.addEventListener("mouseleave",()=>{this.m.x=-9999;this.m.y=-9999});requestAnimationFrame(this.f)}setColor(c){this.color=c;this.line=c}resize(){const w=innerWidth,h=innerHeight;this.c.width=Math.round(w*this.dpr);this.c.height=Math.round(h*this.dpr);this.c.style.width=w+"px";this.c.style.height=h+"px";this.x.setTransform(this.dpr,0,0,this.dpr,0,0)}init(){this.p=[];const n=Math.round(Math.min(this.max,Math.max(30,innerWidth*0.04)));for(let i=0;i<n;i++)this.p.push(this.cr())}cr(){const w=innerWidth,h=innerHeight;return{x:Math.random()*w,y:Math.random()*h,r:(Math.random()*1.8)+0.6,vx:(Math.random()-0.5)*0.4,vy:(Math.random()-0.5)*0.4}}step(){const w=this.c.width/this.dpr,h=this.c.height/this.dpr;for(const P of this.p){P.x+=P.vx;P.y+=P.vy;if(P.x<-10)P.x=w+10;if(P.x>w+10)P.x=-10;if(P.y<-10)P.y=h+10;if(P.y>h+10)P.y=-10}}draw(){const g=this.x,w=this.c.width/this.dpr;g.clearRect(0,0,w,this.c.height/this.dpr);for(let i=0;i<this.p.length;i++){const a=this.p[i];for(let j=i+1;j<this.p.length;j++){const b=this.p[j];const dx=a.x-b.x,dy=a.y-b.y,dist=Math.sqrt(dx*dx+dy*dy);if(dist<140){const alpha=Math.max(0,0.45*(1-dist/140));g.strokeStyle=this.rgb(this.line,alpha);g.lineWidth=1;g.beginPath();g.moveTo(a.x,a.y);g.lineTo(b.x,b.y);g.stroke()}}}for(const p of this.p){g.fillStyle=this.rgb(this.color,1);g.beginPath();g.arc(p.x,p.y,p.r,0,Math.PI*2);g.fill()}if(this.m.x>-9998){for(const p of this.p){const dx=p.x-this.m.x,dy=p.y-this.m.y,dist=Math.sqrt(dx*dx+dy*dy);if(dist<120){const alpha=Math.max(0,0.6*(1-dist/120));g.strokeStyle=this.rgb(this.line,alpha);g.beginPath();g.moveTo(p.x,p.y);g.lineTo(this.m.x,this.m.y);g.stroke()}}}}f(){this.step();this.draw();requestAnimationFrame(this.f)}rgb(h,a){const c=h.replace("#","").trim();const full=c.length===3?c.split("").map(x=>x+x).join(""):c;const n=parseInt(full,16);const r=(n>>16)&255,g=(n>>8)&255,b=n&255;return`rgba(${r},${g},${b},${a})`}}let Psys=null;w.addEventListener("load",()=>{const c=el("bg-canvas");if(c)Psys=new PS(c)});const GIT="https://gitlab.com",GRP="hazexxv-group",GAMES="game-stuff-new",APPS="apps";function sf(u,t=9000){return new Promise((res,rej)=>{const T=setTimeout(()=>rej(new Error("timeout")),t);fetch(u).then(r=>{clearTimeout(T);res(r)}).catch(e=>{clearTimeout(T);rej(e)})})}function gp(a,b){return encodeURIComponent(`${a}/${b}`)}async function lg(a,b){const p=gp(a,b),api=`https://gitlab.com/api/v4/projects/${p}/repository/tree?per_page=200&ref=main`;try{const r=await sf(api,8000);if(r.ok){const it=await r.json();const f=(Array.isArray(it)?it.filter(x=>x.type==="blob"&&x.path&&x.path.endsWith(".xml")):[]);return f.map(x=>({name:x.path.split("/").pop(),url:`${GIT}/${a}/${b}/-/raw/main/${encodeURIComponent(x.path)}`}))}}catch(e){}try{const l=`${GIT}/${a}/${b}/-/raw/main/list.json`,lr=await sf(l,6000);if(lr.ok){const L=await lr.json();if(Array.isArray(L))return L.map(x=>({name:x.name||x,url:x.url||`${GIT}/${a}/${b}/-/raw/main/${encodeURIComponent(x)}`}))}}catch(e){}try{const rmd=`${GIT}/${a}/${b}/-/raw/main/README.md`,rm=await sf(rmd,6000);if(rm.ok){const md=await rm.text();const m=[...md.matchAll(/https?:\/\/gitlab\.com\/[^)"]+?\/-\/raw\/[^)"]+\.xml/gi)].map(z=>z[0]);if(m.length)return m.map(u=>{const parts=u.split("/");const name=parts[parts.length-1].split("?")[0];return{name,url:u}})} }catch(e){}return[]}async function LR(k){const map={games:{g:GRP,r:GAMES},apps:{g:GRP,r:APPS}};const cfg=map[k]||map.games;try{const f=await lg(cfg.g,cfg.r);if(f&&f.length)return f}catch(e){}try{const gh=`https://api.github.com/repos/hazexxv/${k}/contents`,r=await sf(gh,7000);if(r.ok){const j=await r.json();const f=(Array.isArray(j)?j.filter(x=>x.name&&x.name.endsWith(".xml")):[]);return f.map(x=>({name:x.name,url:x.download_url}))}}catch(e){}return[]}function RL(items,elid){const L=el(elid);if(!L)return;L.innerHTML="";if(!items||!items.length){for(let i=0;i<12;i++){const li=d.createElement("li");li.className="item";li.setAttribute("aria-hidden","true");const lb=d.createElement("div");lb.className="label";lb.textContent="—";li.appendChild(lb);L.appendChild(li)}return}items.forEach(it=>{const li=d.createElement("li');li.className='item' })}function RLi(items,el){el.innerHTML="";if(!items||!items.length){for(let i=0;i<12;i++){const li=d.createElement("li");li.className="item";li.setAttribute("aria-hidden","true");const lb=d.createElement("div");lb.className="label";lb.textContent="—";li.appendChild(lb);el.appendChild(li)}return}items.forEach(it=>{const li=d.createElement("li");li.className="item";li.tabIndex=0;const lbl=d.createElement("div");lbl.className="label";lbl.textContent=it.name.replace(".xml","");li.appendChild(lbl);li.dataset.url=it.url;const bd=d.createElement("div");bd.className="badge";bd.textContent="LOAD";li.appendChild(bd);li.addEventListener("click",async ()=>{bd.textContent="…";try{await FOpen(it.url,it.name,bd);bd.textContent="OPEN"}catch(e){bd.textContent="ERR"}});li.addEventListener("keydown",e=>{if(e.key==="Enter")li.click()});el.appendChild(li)})}function FL(items,el,q,cid){const qq=q.trim().toLowerCase();const f=(items||[]).filter(i=>i.name.toLowerCase().includes(qq));RLi(f,el);if(cid)el(cid).textContent=f.length}function esc(s){return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function escAttr(s){return String(s).replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function createBlob(name,txt){const safe=String(txt).replace(/<\/script>/gi,"<\\/script>");const html="<!doctype html><html lang=\"en\"><head><meta charset=\"utf-8\"><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\"><title>"+escAttr(name)+"</title><style>html,body{height:100%;margin:0;background:transparent;color:#fff}#container{height:100%;width:100%;display:flex;align-items:center;justify-content:center;padding:20px;box-sizing:border-box}pre{white-space:pre-wrap;word-break:break-word;padding:18px;background:rgba(0,0,0,0.85);border-radius:8px;color:#eaeaea;max-height:100%;overflow:auto}</style></head><body><div id=\"container\"><pre id=\"xmlOutput\">"+esc(safe)+"</pre></div><script>(function(){})();</script></body></html>";const b=new Blob([html],{type:"text/html"});return URL.createObjectURL(b)}async function OpenUI(n,txt){const url=createBlob(n,txt);el("content")?.setAttribute("aria-hidden","true");el("sidebar")?.setAttribute("aria-hidden","true");const app=el("app-ui"),f=el("app-ui-frame");if(!app||!f){el("embed-container")?.classList.remove("hidden");el("embed-frame").src=url;return}if(f.dataset.bu){try{URL.revokeObjectURL(f.dataset.bu)}catch(e){}f.dataset.bu="";}f.src=url;f.dataset.bu=url;app.classList.remove("hidden");app.setAttribute("aria-hidden","false");f.style.overflow="auto"}function CloseUI(){const app=el("app-ui"),f=el("app-ui-frame");if(f){if(f.dataset.bu){try{URL.revokeObjectURL(f.dataset.bu)}catch(e){}f.dataset.bu=""}f.src=""}if(app)app.classList.add("hidden");el("content")?.removeAttribute("aria-hidden");el("sidebar")?.removeAttribute("aria-hidden")}el("app-ui-close")?.addEventListener("click",CloseUI);el("app-ui-back")?.addEventListener("click",CloseUI);async function FOpen(u,n,b){let last=null;for(let i=0;i<3;i++){try{const r=await sf(u,10000);if(!r.ok)throw new Error("bad "+r.status);const t=await r.text();await OpenUI(n,t);if(b)b.textContent="OPEN";return}catch(e){last=e;await new Promise(r=>setTimeout(r,400+i*300))}}throw last}function embedRaw(txt,n){const c=el("embed-container"),f=el("embed-frame");if(f&&f.dataset.blob){try{URL.revokeObjectURL(f.dataset.blob)}catch(e){}f.dataset.blob=""}const b=new Blob([txt],{type:"text/xml"});const u=URL.createObjectURL(b);if(f){f.src=u;f.dataset.blob=u}if(c)c.classList.remove("hidden");updateEmbed(n)}function updateEmbed(n){const a=el("embed-actions");if(!a)return;a.innerHTML="";const t=d.createElement("div");t.className="embed-action-btn";t.textContent=n.replace(".xml","");t.style.fontWeight="800";const cbtn=d.createElement("button");cbtn.className="embed-action-btn";cbtn.textContent="Close";cbtn.addEventListener("click",closeEmbed);const cl=d.createElement("button");cl.className="embed-action-btn";cl.textContent="Cloak";cl.addEventListener("click",cloakEmbed);const fs=d.createElement("button");fs.className="embed-action-btn";fs.textContent="Fullscreen";fs.addEventListener("click",fullEmbed);a.appendChild(t);a.appendChild(cbtn);a.appendChild(cl);a.appendChild(fs)}function closeEmbed(){const c=el("embed-container"),f=el("embed-frame");if(c)c.classList.add("hidden");if(f&&f.dataset.blob){try{URL.revokeObjectURL(f.dataset.blob)}catch(e){}f.dataset.blob=""}if(f)f.src=""}function cloakEmbed(){const f=el("embed-frame");if(!f)return;const u=f.src;const o=open("about:blank");o.document.write('<iframe src="'+u+'" style="border:none;width:100%;height:100vh"></iframe>');closeEmbed()}function fullEmbed(){const f=el("embed-frame");if(!f)return;if(f.requestFullscreen)f.requestFullscreen();else if(f.webkitRequestFullscreen)f.webkitRequestFullscreen();else if(f.msRequestFullscreen)f.msRequestFullscreen()}el("embed-close")?.addEventListener("click",closeEmbed);el("embed-cloak")?.addEventListener("click",cloakEmbed);el("embed-full")?.addEventListener("click",fullEmbed);el("close-log")?.addEventListener("click",()=>{const u=el("updateLog");if(u)u.style.display="none"});el("cloak-btn")?.addEventListener("click",()=>{const o=open("about:blank");o.document.write('<iframe src="'+location.href+'" style="border:none;width:100%;height:100vh"></iframe>');location.href="https://ixl.com"});const pe=el("prevent-close");if(pe){const sv=localStorage.getItem("preventClose");pe.checked=sv==="true";pe.addEventListener("change",e=>localStorage.setItem("preventClose",e.target.checked?"true":"false"))}w.addEventListener("beforeunload",e=>{if(localStorage.getItem("preventClose")==="true"){e.preventDefault();e.returnValue=""}});q(".settings-nav").forEach(b=>b.addEventListener("click",()=>{q(".settings-nav").forEach(x=>x.classList.remove("active"));b.classList.add("active");const t=b.dataset.s;q(".settings-panel").forEach(p=>p.classList.add("hidden"));const P=d.querySelector(`.settings-panel[data-panel="${t}"]`);if(P)P.classList.remove("hidden")}));function buildTG(){const g=el("theme-grid");if(!g)return;g.innerHTML="";THEMES.forEach(t=>{const tile=d.createElement("div");tile.className="theme-tile";const nm=d.createElement("div");nm.className="theme-name";nm.textContent=t.id;const sw=d.createElement("div");sw.className="theme-swatch";sw.style.background=`linear-gradient(90deg, ${t.v.r1}, ${t.v.r2})`;tile.appendChild(nm);tile.appendChild(sw);tile.addEventListener("click",()=>{A(t.id);closeTG()});g.appendChild(tile)})}function openTG(){el("theme-modal")?.classList.remove("hidden")}function closeTG(){el("theme-modal")?.classList.add("hidden")}el("open-theme-modal")?.addEventListener("click",()=>{buildTG();openTG()});el("close-theme-modal")?.addEventListener("click",closeTG);async function init(){A(localStorage.getItem("astraTheme")||"black");const games=await LR("games");const apps=await LR("apps");const gl=el("game-list");const tl=el("tool-list");if(gl)RLi(games,gl);if(tl)RLi(apps,tl);if(el("games-count"))el("games-count").textContent=(games.length||0);if(el("tools-count"))el("tools-count").textContent=(apps.length||0);const gs=el("games-search");if(gs)gs.addEventListener("input",()=>FL(games,gl,gs.value,"games-count"));const ts=el("tools-search");if(ts)ts.addEventListener("input",()=>FL(apps,tl,ts.value,"tools-count"));q(".tab").forEach(t=>t.addEventListener("keydown",e=>{if(e.key==="Enter")t.click()}))}init();
})();
